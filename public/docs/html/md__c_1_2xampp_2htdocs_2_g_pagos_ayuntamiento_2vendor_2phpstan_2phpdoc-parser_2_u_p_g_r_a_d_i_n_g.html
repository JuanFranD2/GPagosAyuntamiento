<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GPagosAyuntHin: Upgrading from phpstan/phpdoc-parser 1.x to 2.0</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GPagosAyuntHin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__c_1_2xampp_2htdocs_2_g_pagos_ayuntamiento_2vendor_2phpstan_2phpdoc-parser_2_u_p_g_r_a_d_i_n_g.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Upgrading from phpstan/phpdoc-parser 1.x to 2.0 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2 class="doxsection"><a class="anchor" id="autotoc_md10133"></a>
PHP version requirements</h2>
<p>phpstan/phpdoc-parser now requires PHP 7.4 or newer to run.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10134"></a>
Changed constructors of parser classes</h2>
<p>Instead of different arrays and boolean values passed into class constructors during setup, parser classes now share a common ParserConfig object.</p>
<p>Before:</p>
<div class="fragment"><div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_lexer_1_1_lexer.html">PHPStan\PhpDocParser\Lexer\Lexer</a>;</div>
<div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_const_expr_parser.html">PHPStan\PhpDocParser\Parser\ConstExprParser</a>;</div>
<div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_type_parser.html">PHPStan\PhpDocParser\Parser\TypeParser</a>;</div>
<div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_php_doc_parser.html">PHPStan\PhpDocParser\Parser\PhpDocParser</a>;</div>
<div class="line"> </div>
<div class="line">$usedAttributes = [<span class="stringliteral">&#39;lines&#39;</span> =&gt; <span class="keyword">true</span>, <span class="stringliteral">&#39;indexes&#39;</span> =&gt; <span class="keyword">true</span>];</div>
<div class="line"> </div>
<div class="line">$lexer = <span class="keyword">new</span> Lexer();</div>
<div class="line">$constExprParser = <span class="keyword">new</span> ConstExprParser(<span class="keyword">true</span>, <span class="keyword">true</span>, $usedAttributes);</div>
<div class="line">$typeParser = <span class="keyword">new</span> TypeParser($constExprParser, <span class="keyword">true</span>, $usedAttributes);</div>
<div class="line">$phpDocParser = <span class="keyword">new</span> PhpDocParser($typeParser, $constExprParser, <span class="keyword">true</span>, <span class="keyword">true</span>, $usedAttributes);</div>
<div class="ttc" id="aclass_p_h_p_stan_1_1_php_doc_parser_1_1_lexer_1_1_lexer_html"><div class="ttname"><a href="class_p_h_p_stan_1_1_php_doc_parser_1_1_lexer_1_1_lexer.html">PHPStan\PhpDocParser\Lexer\Lexer</a></div><div class="ttdef"><b>Definition</b> Lexer.php:14</div></div>
<div class="ttc" id="aclass_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_const_expr_parser_html"><div class="ttname"><a href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_const_expr_parser.html">PHPStan\PhpDocParser\Parser\ConstExprParser</a></div><div class="ttdef"><b>Definition</b> ConstExprParser.php:12</div></div>
<div class="ttc" id="aclass_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_php_doc_parser_html"><div class="ttname"><a href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_php_doc_parser.html">PHPStan\PhpDocParser\Parser\PhpDocParser</a></div><div class="ttdef"><b>Definition</b> PhpDocParser.php:25</div></div>
<div class="ttc" id="aclass_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_type_parser_html"><div class="ttname"><a href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_type_parser.html">PHPStan\PhpDocParser\Parser\TypeParser</a></div><div class="ttdef"><b>Definition</b> TypeParser.php:17</div></div>
</div><!-- fragment --><p>After:</p>
<div class="fragment"><div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_lexer_1_1_lexer.html">PHPStan\PhpDocParser\Lexer\Lexer</a>;</div>
<div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_config.html">PHPStan\PhpDocParser\ParserConfig</a>;</div>
<div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_const_expr_parser.html">PHPStan\PhpDocParser\Parser\ConstExprParser</a>;</div>
<div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_type_parser.html">PHPStan\PhpDocParser\Parser\TypeParser</a>;</div>
<div class="line">use <a class="code hl_class" href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_1_1_php_doc_parser.html">PHPStan\PhpDocParser\Parser\PhpDocParser</a>;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_variable" href="barryvdh_2laravel-ide-helper_2_8php-cs-fixer_8dist_8php.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a> = <span class="keyword">new</span> ParserConfig(usedAttributes: [<span class="stringliteral">&#39;lines&#39;</span> =&gt; <span class="keyword">true</span>, <span class="stringliteral">&#39;indexes&#39;</span> =&gt; <span class="keyword">true</span>]);</div>
<div class="line">$lexer = <span class="keyword">new</span> Lexer(<a class="code hl_variable" href="barryvdh_2laravel-ide-helper_2_8php-cs-fixer_8dist_8php.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>);</div>
<div class="line">$constExprParser = <span class="keyword">new</span> ConstExprParser(<a class="code hl_variable" href="barryvdh_2laravel-ide-helper_2_8php-cs-fixer_8dist_8php.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>);</div>
<div class="line">$typeParser = <span class="keyword">new</span> TypeParser(<a class="code hl_variable" href="barryvdh_2laravel-ide-helper_2_8php-cs-fixer_8dist_8php.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>, $constExprParser);</div>
<div class="line">$phpDocParser = <span class="keyword">new</span> PhpDocParser(<a class="code hl_variable" href="barryvdh_2laravel-ide-helper_2_8php-cs-fixer_8dist_8php.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a>, $typeParser, $constExprParser);</div>
<div class="ttc" id="abarryvdh_2laravel-ide-helper_2_8php-cs-fixer_8dist_8php_html_a49c7011be9c979d9174c52a8b83e5d8e"><div class="ttname"><a href="barryvdh_2laravel-ide-helper_2_8php-cs-fixer_8dist_8php.html#a49c7011be9c979d9174c52a8b83e5d8e">$config</a></div><div class="ttdeci">$config</div><div class="ttdef"><b>Definition</b> .php-cs-fixer.dist.php:8</div></div>
<div class="ttc" id="aclass_p_h_p_stan_1_1_php_doc_parser_1_1_parser_config_html"><div class="ttname"><a href="class_p_h_p_stan_1_1_php_doc_parser_1_1_parser_config.html">PHPStan\PhpDocParser\ParserConfig</a></div><div class="ttdef"><b>Definition</b> ParserConfig.php:6</div></div>
</div><!-- fragment --><p>The point of ParserConfig is that over the course of phpstan/phpdoc-parser 2.x development series it's most likely going to gain new optional parameters akin to PHPStan's <a href="https://phpstan.org/blog/what-is-bleeding-edge">bleeding edge</a>. These parameters will allow opting in to new behaviour which will become the default in 3.0.</p>
<p>With ParserConfig object, it's now going to be impossible to configure parser classes inconsistently. Which <a href="https://github.com/phpstan/phpdoc-parser/issues/251#issuecomment-2333927959">happened to users</a> when they were separate boolean values.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10135"></a>
Support for parsing Doctrine annotations</h2>
<p>This parser now supports parsing <a href="https://github.com/doctrine/annotations">Doctrine Annotations</a>. The AST nodes representing Doctrine Annotations live in the <a href="https://phpstan.github.io/phpdoc-parser/2.0.x/namespace-PHPStan.PhpDocParser.Ast.PhpDoc.Doctrine.html">PHPStan\PhpDocParser\Ast\PhpDoc\Doctrine namespace</a>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10136"></a>
Whitespace before description is required</h2>
<p>phpdoc-parser 1.x sometimes silently consumed invalid part of a PHPDoc type as description:</p>
<div class="fragment"><div class="line"></div>
</div><!-- fragment --><p>This became <span class="tt">IdentifierTypeNode</span> of <span class="tt">\Closure</span> and with <span class="tt">(...int, string): string</span> as description. (Valid callable syntax is: <span class="tt">\Closure(int ...$u, string): string</span>.)</p>
<p>Another example:</p>
<div class="fragment"><div class="line"></div>
</div><!-- fragment --><p>The extra <span class="tt">}</span> also became description.</p>
<p>Both of these examples are now InvalidTagValueNode.</p>
<p>If these parts are supposed to be PHPDoc descriptions, you need to put whitespace between the type and the description text:</p>
<div class="fragment"><div class="line"></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md10137"></a>
Type aliases with invalid types are preserved</h2>
<p>In phpdoc-parser 1.x, invalid type alias syntax was represented as <a href="https://phpstan.github.io/phpdoc-parser/2.0.x/PHPStan.PhpDocParser.Ast.PhpDoc.InvalidTagValueNode.html"><span class="tt">InvalidTagValueNode</span></a>, losing information about a type alias being present.</p>
<div class="fragment"><div class="line"></div>
</div><!-- fragment --><p>This <span class="tt">@phpstan-type</span> is missing the actual type to alias. In phpdoc-parser 2.0 this is now represented as <a href="https://phpstan.github.io/phpdoc-parser/2.0.x/PHPStan.PhpDocParser.Ast.PhpDoc.TypeAliasTagValueNode.html"><span class="tt">TypeAliasTagValueNode</span></a> (instead of <span class="tt">InvalidTagValueNode</span>) with <a href="https://phpstan.github.io/phpdoc-parser/2.0.x/PHPStan.PhpDocParser.Ast.Type.InvalidTypeNode.html"><span class="tt">InvalidTypeNode</span></a> in place of the type.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10138"></a>
Removal of QuoteAwareConstExprStringNode</h2>
<p>The class <a href="https://phpstan.github.io/phpdoc-parser/1.23.x/PHPStan.PhpDocParser.Ast.ConstExpr.QuoteAwareConstExprStringNode.html">QuoteAwareConstExprStringNode</a> has been removed.</p>
<p>Instead, <a href="https://phpstan.github.io/phpdoc-parser/2.0.x/PHPStan.PhpDocParser.Ast.ConstExpr.ConstExprStringNode.html">ConstExprStringNode</a> gained information about the kind of quotes being used.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10139"></a>
Removed 2nd parameter of <span class="tt">ConstExprParser::parse()</span> (<span class="tt">$trimStrings</span>)</h2>
<p><span class="tt">ConstExprStringNode::$value</span> now contains unescaped values without surrounding &lsquo;&rsquo;'<span class="tt"> or </span>""` quotes.</p>
<p>Use <span class="tt">ConstExprStringNode::__toString()</span> or <a href="https://phpstan.github.io/phpdoc-parser/2.0.x/PHPStan.PhpDocParser.Printer.Printer.html"><span class="tt">Printer</span></a> to get the escaped value along with surrounding quotes.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10140"></a>
Text between tags always belongs to description</h2>
<p>Multi-line descriptions between tags were previously represented as separate <a href="https://phpstan.github.io/phpdoc-parser/2.0.x/PHPStan.PhpDocParser.Ast.PhpDoc.PhpDocTextNode.html">PhpDocTextNode</a>:</p>
<div class="fragment"><div class="line"></div>
</div><!-- fragment --><p>The line with <span class="tt">some text in the middle</span> in phpdoc-parser 2.0 is now part of the description of the first <span class="tt">@param</span> tag.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10141"></a>
<span class="tt">ArrayShapeNode</span> construction changes</h2>
<p><span class="tt">ArrayShapeNode</span> constructor made private, added public static methods <span class="tt">createSealed()</span> and <span class="tt">createUnsealed()</span>.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md10142"></a>
Minor BC breaks</h2>
<ul>
<li>Constructor parameter <span class="tt">$isEquality</span> in <span class="tt">AssertTag*ValueNode</span> made required</li>
<li>Constructor parameter <span class="tt">$templateTypes</span> in <span class="tt">MethodTagValueNode</span> made required</li>
<li>Constructor parameter <span class="tt">$isReference</span> in <span class="tt">ParamTagValueNode</span> made required</li>
<li>Constructor parameter <span class="tt">$isReference</span> in <span class="tt">TypelessParamTagValueNode</span> made required</li>
<li>Constructor parameter <span class="tt">$templateTypes</span> in <span class="tt">CallableTypeNode</span> made required</li>
<li>Constructor parameters <span class="tt">$expectedTokenValue</span> and <span class="tt">$currentTokenLine</span> in <span class="tt">ParserException</span> made required</li>
<li><span class="tt">ArrayShapeItemNode</span> and <span class="tt">ObjectShapeItemNode</span> are not standalone TypeNode, just Node </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
